/*! WIMP Member Directory - v0.1.0
 * http://beawimp.org/member-directory
 * Copyright (c) 2015;
 * Licensed GPLv2+
 */
var WMD;!function(a,b){"use strict";var c,d,e=a.document,f=a.wp,g=(a.tinymce,!1),h=!1;WMD={init:function(){WMD.uploadLogo(),WMD.uploadPortfolio(),WMD.deletePortfolio(),WMD.changePortfolio(),WMD.editListing(),b.fn.select2&&(b(".state-selection").select2({placeholder:"Select a state"}),b(".city-selection").select2({placeholder:"Select a city"}),b(".industry-selection").select2({placeholder:"What industries do you work with?"}),b(".tech-selection").select2({placeholder:"What technologies do you use?"}),b(".services-selection").select2({placeholder:"What services do you provide?"}))},uploadLogo:function(){b(e.getElementsByClassName("upload-logo")).click(function(a){a.preventDefault(),WMD.media(b(a.target),"upload","logo")})},uploadPortfolio:function(){b(e.getElementsByClassName("upload-portfolio")).on("click",function(a){a.preventDefault(),WMD.media(b(a.target),"upload","portfolio")})},deletePortfolio:function(){b(e.getElementsByClassName("wmd-control")).on("click",function(a){a.preventDefault(),b(a.target).parents(".media-grid-item").remove()})},changePortfolio:function(){b(e.getElementsByClassName("change-portfolio")).on("click",function(a){a.preventDefault(),WMD.media(b(a.target),"update","portfolio")})},media:function(a,d,g){"undefined"!=typeof c&&c.close(),c=f.media.frames.customHeader=f.media({title:"Upload image to your Directory Listing",library:{type:"image"},button:{text:"Insert Image"},multiple:!1}),c.on("select",function(){var h=c.state().get("selection").first().toJSON();if("upload"===d)if("portfolio"===g){var i=f.template("media-item"),j={url:h.sizes.full.url,thumb:h.sizes.thumbnail.url,id:h.id,alt:h.title,name:"wmd["+g+"]["+h.id+"]",type:g};b(e.getElementsByClassName("portfolio-items")).find(".upload-btn").before(i(j)),WMD.deletePortfolio(),WMD.changePortfolio()}else"logo"===g&&a.attr("src",h.sizes.thumbnail.url).parent().next().attr("value",h.sizes.full.url).next().attr("value",h.id);else if("update"===d){a.attr("src",h.sizes.thumbnail.url);var k=h.id;a.parent().next().attr({value:h.sizes.full.url,name:"wmd["+g+"]["+k+"]","data-id":k})}}),c.open()},editListing:function(){b(e.getElementsByClassName("add-new-tax")).click(function(a){a.preventDefault();var c=b(this),f=b(e.getElementById("wmd-listing-nonce")).val();d=c.prev();var g={term:d.val(),tax:d.attr("data-type")};"add-city"===c.attr("id")&&(g.isCity=!0),c.parent().find(".loading").slideDown(),WMD.ajax("wmd_save_listing_tax",f,g)})},saveListing:function(){b(e.getElementById("wmd-listings")).submit(function(a){a.preventDefault();var c=b(this),d=b(e.getElementById("wmd-listing-nonce")).val(),f=this.elements,i={industry:{},tech:{},type:{},portfolio:{}};if(""!==b(e.getElementById("title")).val())return WMD.postNotifications("error","A title is required!");b(e.getElementById("saving-listing")).fadeIn(),tinyMCE.triggerSave(),g=!0,i.content=tinyMCE.activeEditor.getContent(),i.id=c.find("#id").val();for(var j=0;j<f.length;j++){var k=f[j];if(k.hasAttribute("data-save")){var l=k.name.match(/wmd\[(.*)\]\[[0-9]{1,10}\]/);if(null!==l){var m=k.getAttribute("data-id");i.portfolio[m]=k.value}else"industry"===k.id?i.industry=b("#industry").select2("val"):"techonologies"===k.id?i.tech=b("#techonologies").select2("val"):"services"===k.id?i.type=b("#services").select2("val"):"publish"===k.id?k.checked&&(i.publish="publish",h=!0):i[k.id]=k.value}}WMD.ajax("wmd_save_listing_post",d,i)})},ajax:function(a,b,c){f.ajax.send(a,{success:WMD.ajaxSuccess,error:WMD.ajaxError,data:{nonce:b,data:c}})},ajaxSuccess:function(a){if(b(e.getElementById("wmd-listings")).find(".loading").fadeOut(),g)WMD.postNotifications("success",a);else{var c=d.next().attr("id");"add-city"===c?WMD.ajaxCitySuccess(a):WMD.ajaxTaxSuccess(a)}},ajaxTaxSuccess:function(a){var b='<option value="'+a.term_id+'" selected="selected">'+a.name+"*</option>",c=d.prev().prev(),e=c.select2("val"),f=a.name+" has been created and is being reviewed*. Your option will display on your listing soon.";d.val("").prev().prev().append(b),e.push(a.term_id),c.select2("val",e),WMD.listingTaxNotification("success",f)},ajaxCitySuccess:function(a){var b='<option value="'+a.term_id+'" selected="selected">'+a.name+"</option>";d.val("").prev().prev().append(b),d.prev().prev().select2("val",a.term_id)},postNotifications:function(a,c){var d='<div class="wmd-notification wmd-'+a+'">'+c,f=b(e.getElementById("wmd-notifications"));b(e.getElementById("saving-listing")).fadeOut(),h&&(d+=' <a href="/membership-account/view-my-listing/">View Your Listing.</a></div>'),f.empty().html(d),b(e.getElementsByClassName("wmd-notification")).fadeIn()},ajaxError:function(a){g?WMD.postNotifications("error",a):WMD.listingTaxNotification("error",a)},listingTaxNotification:function(a,c){var f='<div class="wmd-notification wmd-'+a+'">'+c+"</div>";b(e.getElementsByClassName("wmd-notification")).fadeOut().remove(),d.next().after(f).next().fadeIn()},isInt:function(a){return!isNaN(a)&&function(a){return(0|a)===a}(parseFloat(a))},load:function(){b.flexslider&&b(".flexslider").flexslider({controlNav:!1})}},b(a).load(WMD.load),b(e).ready(WMD.init)}(this,jQuery,_);